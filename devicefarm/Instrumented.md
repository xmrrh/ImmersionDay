---
title: "Sequential Testing with the Espresso Framework"
chapter: false
weight: 32
---

Perform procedural testing with the **Espresso Framework** 

⦁	Built-in Espresso test
⦁	Espresso is based on the built-in Android Test support library. Espresso Test Recoder, which is built into Android Studio, allows you to easily configure test presets in the order you want, and you can use it to test your apps on Device Farm.

⦁	Return to Android studio and select Run> Record Espresso Test from the menu bar.
⦁	As with launching the app, a popup will appear to select the AVD. Select the device you just set up and press OK.
⦁	The Record Your Test pop-up window will appear with the Run AVD screen displayed. At this time, it is recorded in the right Record List in the order of operation on the app screen.

* Add Assertion is a procedure to check whether the view, text or screen exists.

![Create User](/images/ins1.png)

⦁	In the example, configure a scenario where login-> writing and ending will end.

![Create User](/images/ins2.png)

⦁	After configuring the test, press the OK button to save the test code. We will proceed with the name Default.
⦁	In the menu, go to Build> Rebuild Project and run Build APK(s) in the Build menu to create an APK.

⦁	Run with Espresso Test Local AVD
⦁	First of all, let's do a sequential test with Espresso locally. From the top icon, select Edit Confgurations.

⦁	In the Run / Debug Configuraions popup, select and add Android Instrumented Tests.
⦁	Name the item and select app from Module on General tab. Select All in Package under Test.

![Create User](/images/ins4.png)

⦁	In package, select the appropriate app package.

⦁	In Prefer Android Virtual Device category, select the AVD you created earlier. Then select OK to complete the test setup.



⦁	In addition, comment out the testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner" part of the app's build.gradle specification and add the testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner" to resolve the dependency.

⦁	Since the camera is accessed during the test, the user authority for the camera is acquired. Add the following code above the </manifest> line in the manifests specification.

~~~
    <uses-permission android:name="android.permission.CAMERA" />

    <uses-feature
        android:name="android.hardware.camera"
        android:required="false" />
    <uses-feature
        android:name="android.hardware.camera.autofocus"
        android:required="false" />
~~~
⦁	Building an app for testing may not run on a real device by default. To disable it, add the following parameter to gradle.properties.

~~~
android.injected.testOnly=false
~~~

![Create User](/images/ins6.png)

 ⦁	Now check the Run menu at the top and you will see the test configuration we added earlier. If you select the configuration and run it, the device will run as if you were running an existing app as an AVD, and when the app runs, it will perform the actions you recorded earlier.

![Create User](/images/ins7.png)

 ⦁	If you check the Run Console, after successfully running the Tests ran to completion. You can see the message.

![Create User](/images/ins8.png)v

 ⦁	So far, we have configured espresso, a built-in test framework, and tested it on the local AVD. In the next chapter, we will perform espresso tests and monitor the results through the Device farm.


![Create User](/images/ins9.png)

⦁	Running Espresso Test and Monitoring Results with Device Farm
⦁	The overall procedure is similar to the Fuzz test we conducted earlier. Go back to the Device Farm console and select '+ Create a new project' from the list of projects that ran Fuzz.
⦁	Select '+ Create a new run'


![Create User](/images/ins10.png)

⦁	In the Choose application step, select Android / Apple.
⦁	Upload the built-in Apk from the Upload button, or select it from the list previously uploaded. Proceed to next step.

![Create User](/images/ins11.png)

⦁	On the Configure your test setup screen, set the Test Type to Instrumentation.

![Create User](/images/ins12.png)

⦁	Now you need to upload the instrumentation test generated by Espresso. Typical test package paths are built in '<project name>/app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk'. Or, if the location does not exist or you are not sure, there is a description of the path in the output from the previous local test.
* Advanced Configuration (optional) at the bottom is for video recording of the test and monitoring of App Performance data. Leave as default.

![Create User](/images/ins14.png)

⦁	When the upload is complete, information about the test instrumentation is displayed. The domain information for the base package and the information for Runner are displayed. In this case, espresso is Junit-based, so it is displayed as AndroidJUnitRunner. Leave the enviroment setting for the test filter at the bottom and proceed to the next step.
⦁	Select Devices will be set to Top Devices just like the existing Fuzz test. Sometimes, if you want to configure the model you want or shorten the test time, it is good to test with several models. Check the compatibility of the test app package for each model and proceed to the next step.
⦁	Sepecify device state goes to default. If your test requires compatibility with other language locales, set the desired locale in Device locale. Proceed to the next step.

![Create User](/images/ins15.png)

⦁	You can see the summery of the test progress and set the MAXIMUM MINUTES PER DEVICE to 5 minutes in the Execution timeout. Run Confirm and start run.
⦁	The test will now run on the run list, and will complete within 10 minutes on average.

![Create User](/images/ins16.png)

⦁	If you look at the details in the Devices list, you can see the sequential tests run locally.

![Create User](/images/ins17.png)
